services:
  - type: web
    name: noodles-simulator
    runtime: dotnet
    repo: https://github.com/yanivbahalul/noodles-simulator
    branch: main
    autoDeploy: true

    # Build & start
    buildCommand: |
      dotnet publish -c Release -o out
      pip3 install -r requirements.txt || true
    startCommand: |
      bash -c "dotnet out/NoodlesSimulator.dll & python3 render_monitor.py"

    healthCheckPath: /health
    healthCheckTimeoutSeconds: 10

    disk:
      name: data-keys
      mountPath: /data-keys
      sizeGB: 1

    envVars:
      # ASP.NET
      - key: ASPNETCORE_ENVIRONMENT
        value: Production

      - key: SUPABASE_URL
      - key: SUPABASE_ANON_KEY              
      - key: SUPABASE_SERVICE_ROLE_KEY      
      - key: SUPABASE_BUCKET                
      - key: SUPABASE_SIGNED_URL_TTL      

      - key: SERVICE_ROLE_SECRET           
      - key: ANON_PUBLIC

      # Email (SendGrid preferred for production)
      - key: SENDGRID_API_KEY
      - key: EMAIL_FROM
      - key: EMAIL_TO
      
      # SMTP Fallback (optional - Render blocks SMTP ports)
      - key: EMAIL_SMTP_PASS
      - key: EMAIL_SMTP_USER
      - key: EMAIL_SMTP_SERVER
